{"version":3,"sources":["meteor://ðŸ’»app/imports/startup/both/index.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/imports/api/powerbox.js","meteor://ðŸ’»app/server/main.js"],"names":["module","link","Meteor","v","headers","http","default","accessToken","sessionId","urlRegex","isServer","methods","claimToken","self","console","log","get","getAccessToken","proxyParsed","process","env","HTTP_PROXY","match","requestData","JSON","stringify","resData","options","protocol","host","port","Number","method","path","req","request","res","setEncoding","on","error","chunk","cap","write","end"],"mappings":"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","file":"/app.js","sourcesContent":["// Import modules used by both client and server through a single index entry point\n// e.g. useraccounts configuration file.\n","// Import server startup through a single index entry point\n\nimport '/imports/startup/both';\nimport '/imports/startup/server';\nimport '/imports/api/powerbox';","import { Meteor } from 'meteor/meteor';\nimport { headers } from 'meteor/gadicohen:headers';\nimport http from 'http';\n\nvar accessToken;\nvar sessionId;\nconst urlRegex = /([a-z0-9]+):\\/\\/([a-z0-9\\.]+):([\\d]+)/;\n\nif (Meteor.isServer) {\n\tMeteor.methods({\n\t\t\"sandstorm.submitClaimToken\"(claimToken) {\n\t\t\tconst self = this;\n\t\t\tconsole.log(`claimToken = ${claimToken}`);\n\t\t\tsessionId = headers.get(self, 'x-sandstorm-session-id');\n\t\t\tconsole.log(`sessionId = ${sessionId}`);\n\t\t\tif (Meteor.isServer) {\n\t\t\t\tgetAccessToken(claimToken);\n\t\t\t} else {\n\t\t\t\tconsole.log('getting access token')\n\t\t\t}\n\t\t}\n\t})\n}\n\nfunction getAccessToken(claimToken) {\n\tconst proxyParsed = process.env.HTTP_PROXY.match(urlRegex);\n\tconst requestData = JSON.stringify({\n\t\t\"requestToken\": claimToken,\n\t\t\"requiredPermissions\": [],\n\t});\n\tvar resData = \"\";\n\tconst options = {\n\t\tprotocol: proxyParsed[1],\n\t\thost: proxyParsed[2],\n\t\tport: Number(proxyParsed[3]),\n\t\tmethod: \"POST\",\n\t\tpath: `/http-bridge/session/${sessionId}/claim`,\n\t};\n\tconsole.log('getAccessToken: ' + claimToken)\n\tconsole.log(options);\n\tconst req = http.request(options, function(res) {\n\t\tres.setEncoding('utf8');\n\t\tres.on('error', function(error) {\n\t\t\tconsole.log(error);\n\t\t});\n\t\tres.on('data', function (chunk) {\n\t\t\tresData = resData + chunk;\n\t\t});\n\t\tres.on('end', function () {\n\t\t\tconsole.log(resData);\n\t\t\taccessToken = resData.cap;\n\t\t})\n\t})\n\n\treq.write(requestData);\n\treq.end();\n}","// Server entry point, imports all server code\n\nimport '/imports/startup/server';\nimport '/imports/startup/both';\n"]}